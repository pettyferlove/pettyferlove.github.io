window.addEventListener("DOMContentLoaded",()=>{let l=false;let n;let r=true;let e=CONFIG.path;if(e.length===0){e="search.xml"}else if(/json$/i.test(e)){r=false}const o=CONFIG.root+e;const t=document.getElementById("search-input");const s=document.getElementById("search-result");const d=e=>{return String(e).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x3A;/g,":").replace(/&#(\d+);/g,(e,t)=>{return String.fromCharCode(t)}).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};const f=(e,t,l)=>{let r=e.length;if(r===0)return[];let n=0;let o=[];let s=[];if(!l){t=t.toLowerCase();e=e.toLowerCase()}while((o=t.indexOf(e,n))>-1){s.push({position:o,word:e});n=o+r}return s};const g=(e,t,l,r)=>{let n=l[l.length-1];let o=n.position;let s=n.word;let i=[];let c=0;while(o+s.length<=t&&l.length!==0){if(s===r){c++}i.push({position:o,length:s.length});let e=o+s.length;l.pop();while(l.length!==0){n=l[l.length-1];o=n.position;s=n.word;if(e>o){l.pop()}else{break}}}return{hits:i,start:e,end:t,searchTextCount:c}};const y=(l,e)=>{let r="";let n=e.start;e.hits.forEach(e=>{r+=l.substring(n,e.position);let t=e.position+e.length;r+=`<b class="search-keyword">${l.substring(e.position,t)}</b>`;n=t});r+=l.substring(n,e.end);return r};const i=()=>{let u=t.value.trim().toLowerCase();let r=u.split(/[-\s]+/);if(r.length>1){r.push(u)}let p=[];if(u.length>0){n.forEach(e=>{if(!e.title)return;let i=0;let n=e.title.trim();let t=n.toLowerCase();let c=e.content?e.content.trim().replace(/<[^>]+>/g,""):"";if(CONFIG.localsearch.unescape){c=d(c)}let l=c.toLowerCase();let o=decodeURIComponent(e.url).replace(/\/{2,}/g,"/");let a=[];let h=[];r.forEach(e=>{a=a.concat(f(e,t,false));h=h.concat(f(e,l,false))});if(a.length>0||h.length>0){let e=a.length+h.length;[a,h].forEach(e=>{e.sort((e,t)=>{if(t.position!==e.position){return t.position-e.position}return e.word.length-t.word.length})});let t=[];if(a.length!==0){let e=g(0,n.length,a,u);i+=e.searchTextCountInSlice;t.push(e)}let s=[];while(h.length!==0){let e=h[h.length-1];let t=e.position;let l=e.word;let r=t-20;let n=t+80;if(r<0){r=0}if(n<t+l.length){n=t+l.length}if(n>c.length){n=c.length}let o=g(r,n,h,u);i+=o.searchTextCountInSlice;s.push(o)}s.sort((e,t)=>{if(e.searchTextCount!==t.searchTextCount){return t.searchTextCount-e.searchTextCount}else if(e.hits.length!==t.hits.length){return t.hits.length-e.hits.length}return e.start-t.start});let l=parseInt(CONFIG.localsearch.top_n_per_article,10);if(l>=0){s=s.slice(0,l)}let r="";if(t.length!==0){r+=`<li><a href="${o}" class="search-result-title">${y(n,t[0])}</a>`}else{r+=`<li><a href="${o}" class="search-result-title">${n}</a>`}s.forEach(e=>{r+=`<a href="${o}"><p class="search-result">${y(c,e)}...</p></a>`});r+="</li>";p.push({item:r,searchTextCount:i,hitCount:e,id:p.length})}})}if(r.length===1&&r[0]===""){s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'}else if(p.length===0){s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'}else{p.sort((e,t)=>{if(e.searchTextCount!==t.searchTextCount){return t.searchTextCount-e.searchTextCount}else if(e.hitCount!==t.hitCount){return t.hitCount-e.hitCount}return t.id-e.id});let t='<ul class="search-result-list">';p.forEach(e=>{t+=e.item});t+="</ul>";s.innerHTML=t;window.pjax&&window.pjax.refresh(s)}};const c=t=>{fetch(o).then(e=>e.text()).then(e=>{l=true;n=r?[...(new DOMParser).parseFromString(e,"text/xml").querySelectorAll("entry")].map(e=>{return{title:e.querySelector("title").innerHTML,content:e.querySelector("content").innerHTML,url:e.querySelector("url").innerHTML}}):JSON.parse(e);document.querySelector(".search-pop-overlay").innerHTML="";document.body.style.overflow="";if(t){t()}})};if(CONFIG.localsearch.preload){c()}const a=()=>{document.body.style.overflow="hidden";document.querySelector(".search-pop-overlay").style.display="block";document.querySelector(".popup").style.display="block";document.getElementById("search-input").focus()};const h=()=>{document.querySelector(".search-pop-overlay").style.display="";document.querySelector(".search-pop-overlay").innerHTML='<div class="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div>';c(a)};if(CONFIG.localsearch.trigger==="auto"){t.addEventListener("input",i)}else{document.querySelector(".search-icon").addEventListener("click",i);t.addEventListener("keypress",e=>{if(e.keyCode===13){i()}})}document.querySelector(".popup-trigger").addEventListener("click",()=>{if(l===false){h()}else{a()}});const u=()=>{document.body.style.overflow="";document.querySelector(".search-pop-overlay").style.display="none";document.querySelector(".popup").style.display="none"};document.querySelector(".search-pop-overlay").addEventListener("click",u);document.querySelector(".popup-btn-close").addEventListener("click",u);window.addEventListener("pjax:success",u);window.addEventListener("keyup",e=>{if(e.which===27){u()}})});